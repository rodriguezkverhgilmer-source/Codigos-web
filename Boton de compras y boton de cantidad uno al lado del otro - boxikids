Pega esto en layout/theme.liquid, justo antes de </head>

{% if template.name == 'product' %}
  <style id="os2-qty-atc-styles">
    /* === Dawn 15.4 — Qty (default) + ATC en fila; Buy now 100% debajo === */

    .os2-qty-atc-row{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:12px;
      flex-wrap:nowrap;
    }

    /* Izquierda: bloque de cantidad (tamaño default) */
    .os2-qty-atc-row .product-form__quantity{
      flex:0 0 120px;
      width:120px;
      margin:0 !important;
    }
    /* Oculta solo la etiqueta "Cantidad" (accesible) para no desalinear */
    .os2-qty-atc-row .product-form__quantity .form__label{
      position:absolute !important; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    /* Derecha: el ATC ocupa todo el resto */
    .os2-qty-atc-right{ flex:1 1 auto; width:auto; min-width:0; }
    .os2-qty-atc-right .product-form__submit{ width:100%; margin:0 !important; height:auto; line-height:normal; }

    /* Dinámico (Comprar ahora) debajo y al 100% */
    .product__info-container .product-form__buttons{ display:block !important; width:100%; }
    .product__info-container .shopify-payment-button{ display:block !important; width:100% !important; margin-top:12px; }
    .product__info-container .shopify-payment-button__button,
    .product__info-container .product-form__buttons .shopify-payment-button__button--unbranded,
    .product__info-container .product-form__buttons .shopify-payment-button__button--branded{ width:100% !important; }
    .product__info-container .shopify-payment-button__more-options{ display:block; margin-top:10px; text-align:center; }

    /* Mobile: dar más ancho al ATC sin romper alineación */
    @media (max-width: 749px){
      .os2-qty-atc-row{ gap:8px; }
      .os2-qty-atc-row .product-form__quantity{ flex-basis:96px; width:96px; }
      .os2-qty-atc-right{ display:flex; }
      .os2-qty-atc-right .product-form__submit{ flex:1 1 auto; white-space:nowrap; padding-left:16px; padding-right:16px; }
    }
    @media (max-width: 360px){
      .os2-qty-atc-row{ gap:6px; }
      .os2-qty-atc-row .product-form__quantity{ flex-basis:88px; width:88px; }
      .os2-qty-atc-right .product-form__submit{ padding-left:14px; padding-right:14px; }
    }

    /* ===== Borde qty: único (sin doble línea) y color #010044 ===== */
    .os2-qty-atc-row .product-form__quantity .quantity,
    .os2-qty-atc-row .product-form__quantity quantity-input{
      position:relative;
      border: var(--os2-btn-bw, 1px) solid #010044 !important;   /* fallback 1px (ajustable) */
      border-radius: var(--os2-btn-radius, 9999px) !important;
      box-shadow:none !important; outline:none !important;
      background-clip:padding-box; overflow:hidden;
    }
    .os2-qty-atc-row .product-form__quantity .quantity::before,
    .os2-qty-atc-row .product-form__quantity .quantity::after{ content:none !important; display:none !important; }
    .os2-qty-atc-row .product-form__quantity .quantity__button,
    .os2-qty-atc-row .product-form__quantity .quantity__input{ border:0 !important; box-shadow:none !important; outline:none !important; background:transparent; }

    /* ===== FIX: al cargar, no blanquear ni ocultar el texto del ATC ===== */
    /* Forzamos que, en loading/disabled, mantenga colores y texto visibles */
    .os2-qty-atc-right .product-form__submit.loading,
    .os2-qty-atc-right .product-form__submit.button--loading,
    .os2-qty-atc-right .product-form__submit[aria-busy="true"],
    .os2-qty-atc-right .product-form__submit[aria-disabled="true"],
    .os2-qty-atc-right .product-form__submit:disabled,
    .os2-qty-atc-right .product-form__submit.os2-keep-label{
      background-color: inherit !important;
      color: inherit !important;
      border-color: inherit !important;
    }
    .os2-qty-atc-right .product-form__submit.loading > span,
    .os2-qty-atc-right .product-form__submit.button--loading > span,
    .os2-qty-atc-right .product-form__submit[aria-busy="true"] > span,
    .os2-qty-atc-right .product-form__submit.os2-keep-label > span{
      opacity: 1 !important;
      visibility: visible !important;
    }
    /* Apaga overlays/spinners que cubren texto */
    .os2-qty-atc-right .product-form__submit .loading-overlay,
    .os2-qty-atc-right .product-form__submit .loading-overlay__spinner{
      display:none !important;
    }
    .os2-qty-atc-right .product-form__submit.loading::before,
    .os2-qty-atc-right .product-form__submit.loading::after{
      content:none !important; display:none !important;
    }
  </style>

  <script id="os2-qty-atc-script">
    document.addEventListener('DOMContentLoaded', function(){
      try{
        var info = document.querySelector('.product__info-container');
        if(!info) return;

        var productForm = info.querySelector('product-form');
        var qty     = info.querySelector('.product-form__quantity');   // bloque Cantidad
        var buttons = info.querySelector('.product-form__buttons');    // contenedor ATC + dinámicos
        var submit  = info.querySelector('.product-form__submit');     // botón ATC
        if(!productForm || !qty || !buttons || !submit) return;

        /* Evita doble init */
        if(info.querySelector('.os2-qty-atc-row')) return;

        /* 1) Construir fila qty + ATC */
        var row   = document.createElement('div');
        row.className = 'os2-qty-atc-row';
        var right = document.createElement('div');
        right.className = 'os2-qty-atc-right';

        buttons.parentNode.insertBefore(row, buttons);
        row.appendChild(qty);
        row.appendChild(right);
        right.appendChild(submit);

        /* 2) Igualar grosor/radio del borde del qty al del ATC si existen (>0) */
        try{
          var cs = window.getComputedStyle(submit);
          var bw = parseFloat(cs.borderTopWidth);
          var br = cs.borderRadius;
          if (bw && bw > 0){ row.style.setProperty('--os2-btn-bw', cs.borderTopWidth); }
          if (br){ row.style.setProperty('--os2-btn-radius', br); }
        }catch(_){}

        /* 3) Si Shopify reinyecta el ATC al bloque de botones, lo devolvemos a la fila */
        var obs = new MutationObserver(function(muts){
          muts.forEach(function(m){
            m.addedNodes && m.addedNodes.forEach(function(n){
              if(n.nodeType===1 && n.matches && n.matches('.product-form__submit')){
                right.appendChild(n);
              }
            });
          });
        });
        obs.observe(buttons, {childList:true, subtree:true});

        /* 4) Mientras el botón esté "busy", aplicamos clase para forzar texto visible (por si el tema aplica color:transparent) */
        var obsBtn = new MutationObserver(function(muts){
          muts.forEach(function(m){
            if(m.type === 'attributes' && (m.attributeName === 'aria-busy' || m.attributeName === 'class' || m.attributeName === 'disabled')){
              var busy = submit.getAttribute('aria-busy') === 'true' || submit.classList.contains('loading') || submit.classList.contains('button--loading') || submit.disabled;
              submit.classList.toggle('os2-keep-label', !!busy);
            }
          });
        });
        obsBtn.observe(submit, { attributes:true, attributeFilter:['aria-busy','class','disabled'] });

      }catch(e){ console.warn('os2-qty-atc error:', e); }
    });
  </script>
{% endif %}
